# μ—μ–΄μ»¨ OPC UA μ μ–΄ μ‹μ¤ν…

μ¤‘μ•™μ μ–΄ν• μ—μ–΄μ»¨ μ»¨μ…‰μΌλ΅ OPC UA ν…μ¤νΈλ¥Ό μ„ν•΄ λ§λ“  ν”„λ΅μ νΈ.
μ¨λ„, μµλ„, μ „λ ¥ μ‚¬μ©λ‰, μ „κΈ° μ”κΈ, λ„μ§„ μ”κΈ λ“±μ„ μ‹λ®¬λ μ΄μ…ν•κ³  GUIλ¥Ό ν†µν•΄ μ μ–΄ λ° λ¨λ‹ν„°λ§ κΈ°λ¥μ„ μ κ³µν•¨.

## π”§ κµ¬μ„± μ”μ†

- `server.py`: μ—μ–΄μ»¨ μ‹λ®¬λ μ΄μ… μ„λ²„
- `client.py`: PyQt5 κΈ°λ° GUI ν΄λΌμ΄μ–ΈνΈ
- `simpleServer.py`: μµμ† κµ¬ν„ OPC UA μ„λ²„ (μμ μ©)
- `simpleClient.py`: μµμ† GUI ν΄λΌμ΄μ–ΈνΈ (μμ μ©)

## β… μ£Όμ” κΈ°λ¥

### π–¥οΈ μ„λ²„ (`server.py`)
- μ—μ–΄μ»¨ μƒνƒ λ³€μ μ •μ:
  - **Power** (bool, writable): μ „μ› On/Off
  - **TargetTemperature** (float, writable): λ©ν‘ μ¨λ„
  - **CurrentTemperature**: ν„μ¬ μ¨λ„
  - **Humidity**: μµλ„
  - **PowerUsage**: μ „λ ¥ μ‚¬μ©λ‰
  - **ElectricityCost**: μ „κΈ° μ”κΈ
  - **CurrentRate**: ν„μ¬ μ μ© μ”κΈ
  - **OperationTime**: κ°€λ™ μ‹κ°„
- **λƒ‰λ°© μ‹λ®¬λ μ΄μ…**: λ©ν‘ μ¨λ„ λ€λΉ„ ν„μ¬ μ¨λ„ μ°¨μ— λ”°λΌ λƒ‰λ°© μ†λ„ μ΅°μ 
- **μµλ„ μ‹λ®¬λ μ΄μ…**: μƒλ€ μµλ„μ— λ”°λΌ μ μµ μ†λ„ μ΅°μ 
- **μ „λ ¥ μ‚¬μ©λ‰ κ³„μ‚°**: κΈ°λ³Έ μ†λΉ„μ „λ ¥ + μ¨λ„ μ°¨ + κ³ μ¨ λ³΄μ • + μµλ„ λ³΄μ •
- **λ„μ§„ μ”κΈ κ³„μ‚°**: μ‚¬μ©λ‰μ— λ”°λΌ μ„Έ λ‹¨κ³„ λ‹¨κ°€ μ μ©
  - 200kWh μ΄ν•: 93.3μ›/kWh
  - 200~400kWh: 187.9μ›/kWh
  - 400kWh μ΄κ³Ό: 280.6μ›/kWh
- **μ»¤μ¤ν…€ μ΄λ²¤νΈ μ „μ†΅**: μƒνƒ λ³€ν™” μ‹ μ΄λ²¤νΈ λ°μƒ (μ¨λ„, μ „μ› μƒνƒ ν¬ν•¨)

### π–±οΈ ν΄λΌμ΄μ–ΈνΈ (`client.py`)
- PyQt5 + asyncio ν†µν•© GUI
- μ„λ²„μ™€ OPC UA μ—°κ²° ν›„ μ£Όμ” λ³€μ κµ¬λ…:
  - **CurrentTemperature**, **Humidity**, **PowerUsage**, **ElectricityCost**, **Power**
- GUI μ”μ†:
  - μ¨λ„/μµλ„ ν”„λ΅κ·Έλ μ¤ λ°”
  - μ „λ ¥ μ‚¬μ©λ‰, μ”κΈ ν‘μ‹
  - λ©ν‘ μ¨λ„ μ„¤μ • λ²„νΌ
  - μ „μ› ON/OFF ν† κΈ€

## π“¦ μ”κµ¬ μ‚¬ν•­

- Python 3.13 μ΄μƒ
- Poetry (μμ΅΄μ„± κ΄€λ¦¬)

### μμ΅΄μ„±
- `asyncua`: OPC UA ν†µμ‹ 
- `PyQt5`: GUI
- `qasync`: Qt + asyncio μ—°λ™
- `python-dotenv`: ν™κ²½λ³€μ λ΅λ”©
- `black`: μ½”λ“ ν¬λ§¤ν„° (κ°λ°μ©)

## π€ μ„¤μΉ λ° μ‹¤ν–‰

### 1. μ €μ¥μ† λ³µμ 
```bash
git clone <repository-url>
cd opcua
```

### 2. μμ΅΄μ„± μ„¤μΉ
```bash
poetry install
```

### 3. ν™κ²½ λ³€μ μ„¤μ •
`.env.example` νμΌμ„ λ³µμ‚¬ν•μ—¬ `.env` νμΌ μƒμ„±:
```bash
cp .env.example .env
```

ν•„μ”μ— λ”°λΌ `.env` νμΌ νΈμ§‘:
```
SERVER_HOST=192.0.0.1  # μμ‹ μ IP μ£Όμ†λ΅ λ³€κ²½
SERVER_PORT=4840
```

### 4. μ‹¤ν–‰

#### μ„λ²„ μ‹¤ν–‰
```bash
poetry run python opcua/server.py
```

#### ν΄λΌμ΄μ–ΈνΈ μ‹¤ν–‰
```bash
poetry run python opcua/client.py
```

#### μμ μ© κ°„λ‹¨ λ²„μ „
```bash
# κ°„λ‹¨ν• μ„λ²„ μ‹¤ν–‰
poetry run python opcua/simpleServer.py
# κ°„λ‹¨ν• ν΄λΌμ΄μ–ΈνΈ μ‹¤ν–‰
poetry run python opcua/simpleClient.py
```

## π“‚ ν”„λ΅μ νΈ κµ¬μ΅°
```
opcua/
β”β”€β”€ pyproject.toml      # Poetry μ„¤μ •
β”β”€β”€ poetry.lock         # κ³ μ •λ μμ΅΄μ„±
β”β”€β”€ .env.example        # ν™κ²½ λ³€μ μμ  νμΌ
β””β”€β”€ opcua/
    β”β”€β”€ server.py           # λ©”μΈ μ—μ–΄μ»¨ μ„λ²„
    β”β”€β”€ client.py           # λ©”μΈ GUI ν΄λΌμ΄μ–ΈνΈ
    β”β”€β”€ simpleServer.py     # λ‹¨μν™”λ μμ  μ„λ²„
    β””β”€β”€ simpleClient.py     # λ‹¨μν™”λ μμ  ν΄λΌμ΄μ–ΈνΈ
```

## β™οΈ μ‘λ™ λ°©μ‹

1. μ„λ²„λ” `AirConditioner` κ°μ²΄ μ•„λ μ£Όμ” λ…Έλ“λ“¤μ„ μƒμ„±
2. ν΄λΌμ΄μ–ΈνΈλ” `.env`λ΅ μ„¤μ •λ μ£Όμ†λ΅ μ„λ²„ μ—°κ²°
3. μ£Όμ” λ³€μλ“¤μ„ κµ¬λ…ν•κ³  κ°’ λ³€κ²½ μ‹ GUI μ—…λ°μ΄νΈ
4. μ‚¬μ©μκ°€ λ©ν‘ μ¨λ„λ‚ μ „μ› μ„¤μ •μ„ μ΅°μ‘ν•λ©΄ μ„λ²„μ— λ°μ
5. μ„λ²„λ” μƒνƒλ¥Ό μ‹λ®¬λ μ΄μ…ν•κ³  μ΄λ²¤νΈμ™€ μ”κΈ λ“±μ„ κ°±μ‹ 

## π§  μ°Έκ³ 

* λ„μ§„ μ”κΈ λ΅μ§μ€ `server.py` λ‚΄λ¶€ `calculate_progressive_rate()` ν•¨μμ— κµ¬ν„
* ν΄λΌμ΄μ–ΈνΈλ” `client.py`μ—μ„ κµ¬λ… κΈ°λ° μ‹¤μ‹κ°„ μ—…λ°μ΄νΈ μν–‰
* μ„λ²„λ” λƒ‰λ°©/μ μµ μƒν™©μ„ 1μ΄ μ£ΌκΈ°λ΅ λ°μν•λ©°, OPC UA μ΄λ²¤νΈλ„ μ „μ†΅ν•¨